{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport { ethers } from 'ethers';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar ContractABI = require(\"../build/contracts/TicketToken.json\");\nvar contractABI = ContractABI.abi;\nexport default function App() {\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isMetaMaskInstalled = _useState2[0],\n    setIsMetaMaskInstalled = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isConnected = _useState4[0],\n    setIsConnected = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    readTicketID = _useState6[0],\n    setReadTicketID = _useState6[1];\n  var _useState7 = useState(false),\n    _useState8 = _slicedToArray(_useState7, 2),\n    redeemTicket_ = _useState8[0],\n    setRedeemTicket = _useState8[1];\n  var _useState9 = useState(false),\n    _useState10 = _slicedToArray(_useState9, 2),\n    refundUnusedTicket_ = _useState10[0],\n    setRrefundUnusedTicket = _useState10[1];\n  var _useState11 = useState(null),\n    _useState12 = _slicedToArray(_useState11, 2),\n    ticketPrice = _useState12[0],\n    setTicketPrice = _useState12[1];\n  var _useState13 = useState(''),\n    _useState14 = _slicedToArray(_useState13, 2),\n    texto = _useState14[0],\n    setTexto = _useState14[1];\n  var _useState15 = useState([]),\n    _useState16 = _slicedToArray(_useState15, 2),\n    tickets = _useState16[0],\n    setTickets = _useState16[1];\n  var handleInputChange = function handleInputChange(valor) {\n    setTexto(valor);\n  };\n  var handleRefundUnusedTicket = function handleRefundUnusedTicket() {\n    setRrefundUnusedTicket(true);\n    setReadTicketID(true);\n  };\n  var handleRedeemTicket = function handleRedeemTicket() {\n    setRedeemTicket(true);\n    setReadTicketID(true);\n  };\n  var handleEnviar = function handleEnviar() {\n    setReadTicketID(false);\n    setTexto('');\n    if (redeemTicket_) {\n      redeemTicket(texto);\n    } else if (refundUnusedTicket_) {\n      refundUnusedTicket(texto);\n    }\n  };\n  var contractAddress = '0xeEfB74577aB224585e45e61333f3545D9233C30f';\n  function showTickets() {\n    return _showTickets.apply(this, arguments);\n  }\n  function _showTickets() {\n    _showTickets = _asyncToGenerator(function* () {\n      try {\n        var metamaskProvider = new ethers.BrowserProvider(window.ethereum, 'any');\n        var contract = new ethers.Contract(contractAddress, contractABI, metamaskProvider);\n        var signer = yield metamaskProvider.getSigner();\n        var signerAddress = (yield signer).getAddress();\n        var signerAddressStr = (yield signerAddress).toString();\n        var blockInterval = 100;\n        var fromBlock = 10187728;\n        var toBlock = yield metamaskProvider.getBlockNumber();\n        var fromBlockAtual = fromBlock;\n        var toBlockAtual = fromBlockAtual + blockInterval;\n        var fetchedTickets = [];\n        while (fromBlockAtual <= toBlock) {\n          var TicketIssuedEvents = yield contract.queryFilter(contract.filters.TicketIssued(), fromBlockAtual, toBlockAtual);\n          for (var event of TicketIssuedEvents) {\n            var ticketId = event.args.ticketId;\n            var to = event.args.to;\n            if (to === signerAddressStr) {\n              fetchedTickets.push({\n                ticketId: ticketId,\n                to: to\n              });\n            }\n          }\n          fromBlockAtual += blockInterval;\n          toBlockAtual += blockInterval;\n        }\n        setTickets(fetchedTickets);\n      } catch (error) {\n        console.error('Erro ao buscar e ler eventos:', error);\n      }\n    });\n    return _showTickets.apply(this, arguments);\n  }\n  return _jsxs(View, {\n    style: styles.container,\n    children: [isConnected && readTicketID && _jsxs(View, {\n      children: [_jsx(TextInput, {\n        placeholder: \"Digite o ID do ingresso\",\n        value: texto,\n        onChangeText: handleInputChange,\n        style: {\n          borderBottomWidth: 1,\n          marginBottom: 15,\n          padding: 8,\n          color: '#fff'\n        }\n      }), _jsx(Button, {\n        title: \"Enviar\",\n        onPress: handleEnviar\n      })]\n    }), isConnected && _jsxs(View, {\n      children: [_jsx(Text, {\n        style: styles.metaMaskText,\n        children: \"Ingressos:\"\n      }), _jsx(FlatList, {\n        data: tickets,\n        keyExtractor: function keyExtractor(item, index) {\n          return index.toString();\n        },\n        renderItem: function renderItem(_ref) {\n          var item = _ref.item;\n          return _jsxs(View, {\n            style: styles.ticketItem,\n            children: [_jsxs(Text, {\n              children: [\"ID do Ingresso: \", item.ticketId]\n            }), _jsxs(Text, {\n              children: [\"Destinat\\xE1rio: \", item.to]\n            })]\n          });\n        }\n      })]\n    }), isConnected && _jsx(View, {\n      style: styles.metaMaskText,\n      children: _jsxs(Text, {\n        style: styles.metaMaskText,\n        children: [\"Pre\\xE7o do ingresso: \", ticketPrice !== null ? `${ticketPrice} ETH` : 'Carregando...']\n      })\n    })]\n  });\n}\nvar styles = StyleSheet.create({\n  ticketItem: {\n    padding: 10,\n    borderBottomWidth: 1,\n    borderBottomColor: '#ccc'\n  }\n});","map":{"version":3,"names":["React","useState","useEffect","StyleSheet","View","TextInput","Text","Button","FlatList","ethers","jsx","_jsx","jsxs","_jsxs","ContractABI","require","contractABI","abi","App","_useState","_useState2","_slicedToArray","isMetaMaskInstalled","setIsMetaMaskInstalled","_useState3","_useState4","isConnected","setIsConnected","_useState5","_useState6","readTicketID","setReadTicketID","_useState7","_useState8","redeemTicket_","setRedeemTicket","_useState9","_useState10","refundUnusedTicket_","setRrefundUnusedTicket","_useState11","_useState12","ticketPrice","setTicketPrice","_useState13","_useState14","texto","setTexto","_useState15","_useState16","tickets","setTickets","handleInputChange","valor","handleRefundUnusedTicket","handleRedeemTicket","handleEnviar","redeemTicket","refundUnusedTicket","contractAddress","showTickets","_showTickets","apply","arguments","_asyncToGenerator","metamaskProvider","BrowserProvider","window","ethereum","contract","Contract","signer","getSigner","signerAddress","getAddress","signerAddressStr","toString","blockInterval","fromBlock","toBlock","getBlockNumber","fromBlockAtual","toBlockAtual","fetchedTickets","TicketIssuedEvents","queryFilter","filters","TicketIssued","event","ticketId","args","to","push","error","console","style","styles","container","children","placeholder","value","onChangeText","borderBottomWidth","marginBottom","padding","color","title","onPress","metaMaskText","data","keyExtractor","item","index","renderItem","_ref","ticketItem","create","borderBottomColor"],"sources":["/home/gabriel/SistDist/interface/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { StyleSheet, View, TextInput, Text, Button, FlatList } from 'react-native';\nimport { ethers } from 'ethers';\nconst ContractABI = require('../build/contracts/TicketToken.json');\nconst contractABI = ContractABI.abi;\n\nexport default function App() {\n  const [isMetaMaskInstalled, setIsMetaMaskInstalled] = useState(false);\n  const [isConnected, setIsConnected] = useState(false);\n  const [readTicketID, setReadTicketID] = useState(false);\n  const [redeemTicket_, setRedeemTicket] = useState(false);\n  const [refundUnusedTicket_, setRrefundUnusedTicket] = useState(false);\n  const [ticketPrice, setTicketPrice] = useState(null);\n  const [texto, setTexto] = useState('');\n  const [tickets, setTickets] = useState([]);\n\n  const handleInputChange = (valor) => {\n    setTexto(valor);\n  };\n\n  const handleRefundUnusedTicket = () => {\n    setRrefundUnusedTicket(true);\n    setReadTicketID(true);\n  };\n\n  const handleRedeemTicket = () => {\n    setRedeemTicket(true);\n    setReadTicketID(true);\n  };\n\n  const handleEnviar = () => {\n    setReadTicketID(false);\n    setTexto('');\n    if (redeemTicket_) {\n      redeemTicket(texto);\n    } else if (refundUnusedTicket_) {\n      refundUnusedTicket(texto);\n    }\n  };\n\n  const contractAddress = '0xeEfB74577aB224585e45e61333f3545D9233C30f';\n\n  async function showTickets() {\n    try {\n      const metamaskProvider = new ethers.BrowserProvider(window.ethereum, 'any');\n      const contract = new ethers.Contract(contractAddress, contractABI, metamaskProvider);\n      const signer = await metamaskProvider.getSigner();\n      const signerAddress = (await signer).getAddress();\n      const signerAddressStr = (await signerAddress).toString();\n\n      const blockInterval = 100;\n      const fromBlock = 10187728;\n      const toBlock = await metamaskProvider.getBlockNumber();\n\n      let fromBlockAtual = fromBlock;\n      let toBlockAtual = fromBlockAtual + blockInterval;\n\n      const fetchedTickets = [];\n\n      while (fromBlockAtual <= toBlock) {\n        const TicketIssuedEvents = await contract.queryFilter(\n          contract.filters.TicketIssued(),\n          fromBlockAtual,\n          toBlockAtual\n        );\n\n        for (const event of TicketIssuedEvents) {\n          const ticketId = event.args.ticketId;\n          const to = event.args.to;\n\n          if (to === signerAddressStr) {\n            fetchedTickets.push({ ticketId, to });\n          }\n        }\n\n        fromBlockAtual += blockInterval;\n        toBlockAtual += blockInterval;\n      }\n\n      setTickets(fetchedTickets);\n    } catch (error) {\n      console.error('Erro ao buscar e ler eventos:', error);\n    }\n  }\n\n  // Restante do código...\n\n  return (\n    <View style={styles.container}>\n      {/* ... Código existente ... */}\n\n      {isConnected && readTicketID && (\n        <View>\n          <TextInput\n            placeholder=\"Digite o ID do ingresso\"\n            value={texto}\n            onChangeText={handleInputChange}\n            style={{ borderBottomWidth: 1, marginBottom: 15, padding: 8, color: '#fff' }}\n          />\n          <Button title=\"Enviar\" onPress={handleEnviar} />\n        </View>\n      )}\n\n      {isConnected && (\n        <View>\n          <Text style={styles.metaMaskText}>Ingressos:</Text>\n          <FlatList\n            data={tickets}\n            keyExtractor={(item, index) => index.toString()}\n            renderItem={({ item }) => (\n              <View style={styles.ticketItem}>\n                <Text>ID do Ingresso: {item.ticketId}</Text>\n                <Text>Destinatário: {item.to}</Text>\n              </View>\n            )}\n          />\n        </View>\n      )}\n\n      {isConnected && (\n        <View style={styles.metaMaskText}>\n          <Text style={styles.metaMaskText}>\n            Preço do ingresso: {ticketPrice !== null ? `${ticketPrice} ETH` : 'Carregando...'}\n          </Text>\n        </View>\n      )}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  // ... Código existente ...\n\n  ticketItem: {\n    padding: 10,\n    borderBottomWidth: 1,\n    borderBottomColor: '#ccc',\n  },\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}